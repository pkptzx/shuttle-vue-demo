import{t as L,r as C,a as S,c as D,w as v,i as I,b,g as O,o as j,s as y,d as M,e as T,f as W,h as B,j as A,k as _,l as k,F as E,m as P,_ as z}from"./index-C1mWqWy2.js";function G(n){return O()?(j(n),!0):!1}const N=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const x=()=>{};function U(...n){if(n.length!==1)return L(...n);const t=n[0];return typeof t=="function"?C(D(()=>({get:t,set:x}))):S(t)}function V(n,t){function r(...e){return new Promise((o,s)=>{Promise.resolve(n(()=>t.apply(this,e),{fn:t,thisArg:this,args:e})).then(o).catch(s)})}return r}const $=n=>n();function q(...n){let t=0,r,e=!0,o=x,s,i,a,c,f;!I(n[0])&&typeof n[0]=="object"?{delay:i,trailing:a=!0,leading:c=!0,rejectOnCancel:f=!1}=n[0]:[i,a=!0,c=!0,f=!1]=n;const l=()=>{r&&(clearTimeout(r),r=void 0,o(),o=x)};return h=>{const d=b(i),w=Date.now()-t,p=()=>s=h();return l(),d<=0?(t=Date.now(),p()):(w>d&&(c||!e)?(t=Date.now(),p()):a&&(s=new Promise((u,g)=>{o=f?g:u,r=setTimeout(()=>{t=Date.now(),e=!0,u(p()),l()},Math.max(0,d-w))})),!c&&!r&&(r=setTimeout(()=>e=!0,d)),e=!1,s)}}function H(n,t,r={}){const{eventFilter:e=$,...o}=r;return v(n,V(e,t),o)}function J(n,t,r={}){const{throttle:e=0,trailing:o=!0,leading:s=!0,...i}=r;return H(n,t,{...i,eventFilter:q(e,o,s)})}const K=N?window:void 0;function Q(){const n=y(!1),t=W();return t&&T(()=>{n.value=!0},t),n}function X(n){const t=Q();return M(()=>(t.value,!!n()))}function Y(n={}){const{interimResults:t=!0,continuous:r=!0,maxAlternatives:e=1,window:o=K}=n,s=U(n.lang||"en-US"),i=y(!1),a=y(!1),c=y(""),f=y(void 0);let l;const R=()=>{i.value=!0},h=()=>{i.value=!1},d=(u=!i.value)=>{u?R():h()},w=o&&(o.SpeechRecognition||o.webkitSpeechRecognition),p=X(()=>w);return p.value&&(l=new w,l.continuous=r,l.interimResults=t,l.lang=b(s),l.maxAlternatives=e,l.onstart=()=>{i.value=!0,a.value=!1},v(s,u=>{l&&!i.value&&(l.lang=u)}),l.onresult=u=>{const g=u.results[u.resultIndex],{transcript:F}=g[0];a.value=g.isFinal,c.value=F,f.value=void 0},l.onerror=u=>{f.value=u},l.onend=()=>{i.value=!1,l.lang=b(s)},v(i,(u,g)=>{u!==g&&(u?l.start():l.stop())})),G(()=>{h()}),{isSupported:p,isListening:i,isFinal:a,recognition:l,result:c,error:f,toggle:d,start:R,stop:h}}const Z={class:"subtitles-renderer",style:{color:"white"}},ee={class:"subtitles-renderer",style:{color:"grey"}},m=50,te=B({__name:"SpeechRecognition",setup(n){const t=S("请允许浏览器弹出的使用麦克风,请使用Edge浏览器"),r=S(""),e=Y({lang:"zh-CN",interimResults:!0,continuous:!0});let o=m/2,s;async function i(){e.start(),v(e.error,()=>{console.log("异常",e.error)}),v(e.result,()=>{console.log("结果",e.result.value),e.result.value.length>=m?(s||(s=e.result.value.slice(-o-5,-o)),o=e.result.value.lastIndexOf(s),o==-1&&(console.log(e.result.value),console.log("keyword",s),console.log("%c见鬼,识别完整句后keyword中间被插入标点了,重新算keyword...","color: red"),o=m/2,s=e.result.value.slice(-o-5,-o),o=e.result.value.lastIndexOf(s),console.log("修正新keyword",s)),t.value=e.result.value.slice(o),t.value.length>=m+5&&(console.log("%c字幕满了,开始清一行","color: blue"),o=m/2,s=e.result.value.slice(-o-5,-o),o=e.result.value.lastIndexOf(s),console.log("新keyword",s))):t.value=e.result.value}),v(e.isListening,()=>{console.log("isListening",e.isListening.value),e.isListening.value||(console.log("isListening",e.isListening.value),e.start())})}return J(t,()=>{fetch(`https://myqr.shuttleapp.rs/translate?txt=${encodeURIComponent(t.value)}&to=en`).then(a=>a.json()).then(a=>{r.value=a.output_text.map(c=>c[0]).join(" ")}),console.log("changed!")},{throttle:5e3}),i(),(a,c)=>(P(),A(E,null,[_("div",Z,k(t.value),1),c[0]||(c[0]=_("br",null,null,-1)),_("div",ee,k(r.value),1)],64))}}),oe=z(te,[["__scopeId","data-v-de16becb"]]);export{oe as default};
