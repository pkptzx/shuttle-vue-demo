import{h as oe,a as le,e as se,j as fe,k as he,m as de}from"./index-B7JHg4ec.js";function j(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ne={},ie;function ve(){return ie||(ie=1,function E(R,q,_){function C(e,t){if(!q[e]){if(!R[e]){var s=typeof j=="function"&&j;if(!t&&s)return s(e,!0);if(B)return B(e,!0);var y=new Error("Cannot find module '"+e+"'");throw y.code="MODULE_NOT_FOUND",y}var r=q[e]={exports:{}};R[e][0].call(r.exports,function(a){var i=R[e][1][a];return C(i||a)},r,r.exports,E,R,q,_)}return q[e].exports}for(var B=typeof j=="function"&&j,k=0;k<_.length;k++)C(_[k]);return C}({1:[function(E,R,q){function _(e,t,s,a){var r=0,a=a===void 0?{}:a,i=a.loop===void 0?null:a.loop,o=a.palette===void 0?null:a.palette;if(t<=0||s<=0||t>65535||s>65535)throw"Width/Height invalid.";function n(v){var m=v.length;if(m<2||m>256||m&m-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return m}e[r++]=71,e[r++]=73,e[r++]=70,e[r++]=56,e[r++]=57,e[r++]=97;var l=0,f=0;if(o!==null){for(var u=n(o);u>>=1;)++l;if(u=1<<l,--l,a.background!==void 0){if(f=a.background,f>=u)throw"Background index out of range.";if(f===0)throw"Background index explicitly passed as 0."}}if(e[r++]=t&255,e[r++]=t>>8&255,e[r++]=s&255,e[r++]=s>>8&255,e[r++]=(o!==null?128:0)|l,e[r++]=f,e[r++]=0,o!==null)for(var x=0,I=o.length;x<I;++x){var w=o[x];e[r++]=w>>16&255,e[r++]=w>>8&255,e[r++]=w&255}if(i!==null){if(i<0||i>65535)throw"Loop count invalid.";e[r++]=33,e[r++]=255,e[r++]=11,e[r++]=78,e[r++]=69,e[r++]=84,e[r++]=83,e[r++]=67,e[r++]=65,e[r++]=80,e[r++]=69,e[r++]=50,e[r++]=46,e[r++]=48,e[r++]=3,e[r++]=1,e[r++]=i&255,e[r++]=i>>8&255,e[r++]=0}var d=!1;this.addFrame=function(v,m,F,p,D,c){if(d===!0&&(--r,d=!1),c=c===void 0?{}:c,v<0||m<0||v>65535||m>65535)throw"x/y invalid.";if(F<=0||p<=0||F>65535||p>65535)throw"Width/Height invalid.";if(D.length<F*p)throw"Not enough pixels for the frame size.";var O=!0,T=c.palette;if(T==null&&(O=!1,T=o),T==null)throw"Must supply either a local or global palette.";for(var Q=n(T),S=0;Q>>=1;)++S;Q=1<<S;var J=c.delay===void 0?0:c.delay,L=c.disposal===void 0?0:c.disposal;if(L<0||L>3)throw"Disposal out of range.";var K=!1,G=0;if(c.transparent!==void 0&&c.transparent!==null&&(K=!0,G=c.transparent,G<0||G>=Q))throw"Transparent color index.";if((L!==0||K||J!==0)&&(e[r++]=33,e[r++]=249,e[r++]=4,e[r++]=L<<2|(K===!0?1:0),e[r++]=J&255,e[r++]=J>>8&255,e[r++]=G,e[r++]=0),e[r++]=44,e[r++]=v&255,e[r++]=v>>8&255,e[r++]=m&255,e[r++]=m>>8&255,e[r++]=F&255,e[r++]=F>>8&255,e[r++]=p&255,e[r++]=p>>8&255,e[r++]=O===!0?128|S-1:0,O===!0)for(var A=0,h=T.length;A<h;++A){var N=T[A];e[r++]=N>>16&255,e[r++]=N>>8&255,e[r++]=N&255}r=C(e,r,S<2?2:S,D)},this.end=function(){return d===!1&&(e[r++]=59,d=!0),r}}function C(e,t,s,y){e[t++]=s;var r=t++,a=1<<s,i=a-1,o=a+1,n=o+1,l=s+1,f=0,u=0;function x(c){for(;f>=c;)e[t++]=u&255,u>>=8,f-=8,t===r+256&&(e[r]=255,r=t++)}function I(c){u|=c<<f,f+=l,x(8)}var w=y[0]&i,d={};I(a);for(var v=1,m=y.length;v<m;++v){var F=y[v]&i,p=w<<8|F,D=d[p];if(D===void 0){for(u|=w<<f,f+=l;f>=8;)e[t++]=u&255,u>>=8,f-=8,t===r+256&&(e[r]=255,r=t++);n===4096?(I(a),n=o+1,l=s+1,d={}):(n>=1<<l&&++l,d[p]=n++),w=F}else w=D}return I(w),I(o),x(1),r+1===t?e[r]=0:(e[r]=t-r-1,e[t++]=0),t}function B(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!==56||e[t++]!==97)throw"Invalid GIF 87a/89a header.";var s=e[t++]|e[t++]<<8,y=e[t++]|e[t++]<<8,r=e[t++],a=r>>7,i=r&7,o=1<<i+1;e[t++],e[t++];var n=null;a&&(n=t,t+=o*3);var l=!0,f=[],u=0,x=null,I=0,w=null;for(this.width=s,this.height=y;l&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,w=e[t++]|e[t++]<<8,t++;else for(t+=12;;){var d=e[t++];if(d===0)break;t+=d}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw"Invalid graphics extension block.";var v=e[t++];u=e[t++]|e[t++]<<8,x=e[t++],(v&1)===0&&(x=null),I=v>>2&7,t++;break;case 254:for(;;){var d=e[t++];if(d===0)break;t+=d}break;default:throw"Unknown graphic control label: 0x"+e[t-1].toString(16)}break;case 44:var m=e[t++]|e[t++]<<8,F=e[t++]|e[t++]<<8,p=e[t++]|e[t++]<<8,D=e[t++]|e[t++]<<8,c=e[t++],O=c>>7,T=c>>6&1,Q=c&7,S=1<<Q+1,J=n,L=!1;if(O){var L=!0;J=t,t+=S*3}var K=t;for(t++;;){var d=e[t++];if(d===0)break;t+=d}f.push({x:m,y:F,width:p,height:D,has_local_palette:L,palette_offset:J,data_offset:K,data_length:t-K,transparent_index:x,interlaced:!!T,delay:u,disposal:I});break;case 59:l=!1;break;default:throw"Unknown gif block: 0x"+e[t-1].toString(16)}this.numFrames=function(){return f.length},this.loopCount=function(){return w},this.frameInfo=function(G){if(G<0||G>=f.length)throw"Frame index out of range.";return f[G]},this.decodeAndBlitFrameBGRA=function(G,A){var h=this.frameInfo(G),N=h.width*h.height,M=new Uint8Array(N);k(e,h.data_offset,M,N);var z=h.palette_offset,H=h.transparent_index;H===null&&(H=256);var W=h.width,V=s-W,X=W,Y=(h.y*s+h.x)*4,b=((h.y+h.height)*s+h.x)*4,g=Y,Z=V*4;h.interlaced===!0&&(Z+=s*4*7);for(var P=8,$=0,ee=M.length;$<ee;++$){var U=M[$];if(X===0&&(g+=Z,X=W,g>=b&&(Z=V*4+s*4*(P-1),g=Y+(W+V)*(P<<1),P>>=1)),U===H)g+=4;else{var re=e[z+U*3],te=e[z+U*3+1],ae=e[z+U*3+2];A[g++]=ae,A[g++]=te,A[g++]=re,A[g++]=255}--X}},this.decodeAndBlitFrameRGBA=function(G,A){var h=this.frameInfo(G),N=h.width*h.height,M=new Uint8Array(N);k(e,h.data_offset,M,N);var z=h.palette_offset,H=h.transparent_index;H===null&&(H=256);var W=h.width,V=s-W,X=W,Y=(h.y*s+h.x)*4,b=((h.y+h.height)*s+h.x)*4,g=Y,Z=V*4;h.interlaced===!0&&(Z+=s*4*7);for(var P=8,$=0,ee=M.length;$<ee;++$){var U=M[$];if(X===0&&(g+=Z,X=W,g>=b&&(Z=V*4+s*4*(P-1),g=Y+(W+V)*(P<<1),P>>=1)),U===H)g+=4;else{var re=e[z+U*3],te=e[z+U*3+1],ae=e[z+U*3+2];A[g++]=re,A[g++]=te,A[g++]=ae,A[g++]=255}--X}}}function k(e,t,s,y){for(var r=e[t++],a=1<<r,i=a+1,o=i+1,n=r+1,l=(1<<n)-1,f=0,u=0,x=0,I=e[t++],w=new Int32Array(4096),d=null;;){for(;f<16&&I!==0;)u|=e[t++]<<f,f+=8,I===1?I=e[t++]:--I;if(f<n)break;var v=u&l;if(u>>=n,f-=n,v===a){o=i+1,n=r+1,l=(1<<n)-1,d=null;continue}else if(v===i)break;for(var m=v<o?v:d,F=0,p=m;p>a;)p=w[p]>>8,++F;var D=p,c=x+F+(m!==v?1:0);if(c>y){console.log("Warning, gif stream longer than expected.");return}s[x++]=D,x+=F;var O=x;for(m!==v&&(s[x++]=D),p=m;F--;)p=w[p],s[--O]=p&255,p>>=8;d!==null&&o<4096&&(w[o++]=d<<8|D,o>=l+1&&n<12&&(++n,l=l<<1|1)),d=v}return x!==y&&console.log("Warning, gif stream shorter than expected."),s}try{q.GifWriter=_,q.GifReader=B}catch{}},{}],2:[function(E,R,q){var _,C,B,k,e,t,s,y=function(r,a){return function(){return r.apply(a,arguments)}};C=E("omggif").GifReader,t=function(r){var a;return a=new XMLHttpRequest,a.open("GET",r,!0),a.responseType="arraybuffer",{xhr:a,get:function(i){return a.onload=s(i),a.send(),this},animate:function(i){var o;return o=e(i),a.onload=s(function(n){return n.animateInCanvas(o)}),a.send(),this},frames:function(i,o,n){var l;return n==null&&(n=!1),l=e(i),a.onload=s(function(f){return f.onDrawFrame=o,f.animateInCanvas(l,n)}),a.send(),this}}},s=function(r){return function(a){return r(new _(new C(new Uint8Array(this.response))))}},e=function(r){var a,i;if(typeof r=="string"&&((i=a=document.querySelector(r))!=null?i.tagName:void 0)==="CANVAS")return a;if((r!=null?r.tagName:void 0)==="CANVAS")return r;throw new Error("Unexpected selector type. Valid types are query-selector-string/canvas-element")},B=function(r,a,i){var o,n,l;return o=document.createElement("canvas"),n=o.getContext("2d"),o.width=r.width,o.height=r.height,l=n.createImageData(a,i),l.data.set(r.pixels),n.putImageData(l,-r.x,-r.y),o},k=function(r,a){var i;return(function(){i=[];for(var o=0,n=r.numFrames();0<=n?o<n:o>n;0<=n?o++:o--)i.push(o);return i}).apply(this).map(function(o){return function(n){var l;return l=r.frameInfo(n),l.pixels=new Uint8ClampedArray(r.width*r.height*4),r.decodeAndBlitFrameRGBA(n,l.pixels),l}}())},_=function(){function r(a){var i;this._reader=a,this._advanceFrame=y(this._advanceFrame,this),this._nextFrameRender=y(this._nextFrameRender,this),this._nextFrame=y(this._nextFrame,this),i=this._reader,this.width=i.width,this.height=i.height,this._frames=k(this._reader),this._loopCount=this._reader.loopCount(),this._loops=0,this._frameIndex=0,this._running=!1}return r.prototype.start=function(){return this._lastTime=new Date().valueOf(),this._delayCompensation=0,this._running=!0,setTimeout(this._nextFrame,0),this},r.prototype.stop=function(){return this._running=!1,this},r.prototype.reset=function(){return this._frameIndex=0,this._loops=0,this},r.prototype._nextFrame=function(){requestAnimationFrame(this._nextFrameRender)},r.prototype._nextFrameRender=function(){var a,i;if(this._running)return a=this._frames[this._frameIndex],(i=this.onFrame)!=null&&i.apply(this,[a,this._frameIndex]),this._enqueueNextFrame()},r.prototype._advanceFrame=function(){this._frameIndex+=1,this._frameIndex>=this._frames.length&&(this._loopCount!==0&&this._loopCount===this._loops?this.stop():(this._frameIndex=0,this._loops+=1))},r.prototype._enqueueNextFrame=function(){var a,i,o,n;for(this._advanceFrame();this._running;)if(o=this._frames[this._frameIndex],i=new Date().valueOf()-this._lastTime,this._lastTime+=i,this._delayCompensation+=i,n=o.delay*10,a=n-this._delayCompensation,this._delayCompensation-=n,a<0){this._advanceFrame();continue}else{setTimeout(this._nextFrame,a);break}},r.prototype.animateInCanvas=function(a,i){var o;return i==null&&(i=!0),i&&(a.width=this.width,a.height=this.height),o=a.getContext("2d"),this.onDrawFrame==null&&(this.onDrawFrame=function(n,l,f){return n.drawImage(l.buffer,l.x,l.y)}),this.onFrame==null&&(this.onFrame=function(n){return function(l,f){var u,x;switch(l.buffer==null&&(l.buffer=B(l,n.width,n.height)),typeof n.disposeFrame=="function"&&n.disposeFrame(),l.disposal){case 2:n.disposeFrame=function(){return o.clearRect(0,0,a.width,a.height)};break;case 3:x=o.getImageData(0,0,a.width,a.height),n.disposeFrame=function(){return o.putImageData(x,0,0)};break;default:n.disposeFrame=null}return(u=n.onDrawFrame)!=null?u.apply(n,[o,l,f]):void 0}}(this)),this.start(),this},r}(),t.Animator=_,t.decodeFrames=k,t.createBufferCanvas=B,typeof window<"u"&&window!==null&&(window.gifler=t),typeof R<"u"&&R!==null&&(R.exports=t)},{omggif:1}]},{},[2])),ne}ve();const ue=oe({__name:"CanvasDrawGif",setup(E){const R=le();function q(_,C){_.canvas.width=_.canvas.offsetWidth,_.canvas.height=_.canvas.offsetHeight,_.fillText("半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖半糖",0,50);for(var B=Math.floor(_.canvas.width/150),k=0;k<B;k++){var e=k*150;_.drawImage(C.buffer,C.x+e,C.y,150,100)}}return se(async()=>{gifler("/run.gif").frames(R.value,q)}),(_,C)=>(de(),fe("div",null,[he("canvas",{ref_key:"canvas",ref:R,class:"example",width:"670",height:"100"},null,512)]))}});export{ue as default};
